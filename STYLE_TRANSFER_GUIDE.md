# 画风迁移功能使用指南

## 功能概述

画风迁移功能允许你将一张图片（A图）的视觉风格应用到另一张或多张图片（B图）上，实现批量风格转换。

## 核心特性

- ✅ **批量转换**：一次选择多张目标图片进行转换
- ✅ **多种来源**：支持上传、历史记录、素材库
- ✅ **参数控制**：风格强度、结构保留、描述增强
- ✅ **网格支持**：自动识别和处理 3×3、5×5 网格图
- ✅ **完整记录**：保存转换历史到 IndexedDB

## 使用步骤

### 1. 上传风格源图片（A图）

- 点击左侧"风格源图片"区域上传
- 或从历史记录中选择
- 支持拖拽上传

### 2. 添加目标图片（B图）

- 点击"上传图片"按钮选择多张图片
- 或点击"从历史添加"选择已生成的图片
- 可以添加多张图片进行批量转换

### 3. 调整转换参数

- **风格强度**：0-100%，数值越高风格迁移越强烈
- **保留内容结构**：勾选后保持目标图的构图和主体
- **风格描述增强**：可选，添加额外的风格描述

### 4. 开始转换

- 点击"开始转换"按钮
- 查看实时进度
- 转换完成后查看对比结果

### 5. 保存和下载

- 点击"保存到历史"保存转换记录
- 点击"下载全部"批量下载结果
- 或单独下载每张转换后的图片

## 快捷入口

### 从历史记录转换

1. 在"单图生成"页面查看历史记录
2. 点击某条记录的"转换风格"按钮
3. 自动跳转到画风迁移页面，图片已预填充

### 从实时生成转换

1. 在"单图生成"页面生成图片后
2. 点击结果区的"应用其他风格"按钮
3. 自动跳转到画风迁移页面

## 技术说明

### 文件结构

```
style-transfer-app.js           # 主应用逻辑
core/style-transfer-db.js       # IndexedDB 存储
core/style-transfer-engine.js   # 批量转换引擎
```

### API 调用

使用 Gemini API 的双图输入模式：
- 第一张图：风格源（A图）
- 第二张图：转换目标（B图）
- 提示词：控制转换参数

### 数据存储

转换记录保存在 IndexedDB 的 `style_transfer_records` 表中，包含：
- 风格源图片
- 目标图片列表
- 转换参数
- 转换结果
- 元数据（成功/失败统计）

## 注意事项

1. **API Key**：需要先在设置中配置 Gemini API Key
2. **图片大小**：自动压缩到 3MB 以内
3. **转换时间**：取决于图片数量和分辨率
4. **网格图**：自动识别并保持网格布局
5. **错误处理**：单张失败不影响其他图片转换

## 示例场景

### 场景 1：统一游戏资产风格

1. 上传一张标准风格的图标作为 A 图
2. 批量添加其他风格不一致的图标作为 B 图
3. 设置风格强度 80%，勾选"保留内容结构"
4. 批量转换，获得风格统一的图标集

### 场景 2：探索不同艺术风格

1. 上传一张像素风格的参考图作为 A 图
2. 添加一张写实风格的角色图作为 B 图
3. 转换后获得像素风格的角色图
4. 更换不同的 A 图，探索更多风格可能性

### 场景 3：网格图风格转换

1. 在"单图生成"页面生成 3×3 网格图标
2. 点击"应用其他风格"
3. 上传新的风格源图片
4. 转换后获得新风格的 3×3 网格图

## 常见问题

**Q: 转换失败怎么办？**
A: 检查 API Key 是否有效，图片是否过大，网络是否正常。

**Q: 如何控制风格强度？**
A: 调整"风格强度"滑块，数值越高风格迁移越强烈。

**Q: 可以同时转换多少张图片？**
A: 理论上无限制，但建议每次不超过 10 张以避免超时。

**Q: 网格图会被拆分吗？**
A: 不会，网格图会作为整体进行转换，保持布局一致性。

**Q: 转换记录保存在哪里？**
A: 保存在浏览器的 IndexedDB 中，清除浏览器数据会丢失。
